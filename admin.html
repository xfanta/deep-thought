<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Administrace - Hlubina My≈°len√≠‚Ñ¢</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

body {
  font-family: 'JetBrains Mono', 'Consolas', monospace;
  background: #000000;
  color: #00ff41;
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

h1 {
  color: #00ff41;
  text-align: center;
  margin-bottom: 30px;
  font-size: 24px;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #00ff41;
}

input, textarea, button {
  width: 100%;
  padding: 10px;
  background: #111;
  border: 1px solid #00ff41;
  color: #00ff41;
  font-family: inherit;
  font-size: 14px;
}

textarea {
  height: 100px;
  resize: vertical;
}

button {
  background: #003300;
  cursor: pointer;
  margin-top: 10px;
}

button:hover {
  background: #004400;
}

.message-item {
  border: 1px solid #00ff41;
  margin: 10px 0;
  padding: 15px;
  background: #001100;
}

.message-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  font-size: 12px;
  color: #888;
}

.delete-btn {
  background: #330000;
  color: #ff4444;
  border: 1px solid #ff4444;
  width: auto;
  padding: 5px 10px;
  font-size: 12px;
}

.delete-btn:hover {
  background: #440000;
}

.status {
  padding: 10px;
  margin: 10px 0;
  border: 1px solid;
}

.status.success {
  color: #00ff41;
  border-color: #00ff41;
  background: #001100;
}

.status.error {
  color: #ff4444;
  border-color: #ff4444;
  background: #110000;
}

.storage-info {
  padding: 10px;
  margin: 10px 0;
  border: 1px solid #00ffff;
  color: #00ffff;
  background: #001111;
  font-size: 12px;
  text-align: center;
}
</style>
</head>
<body>
<div class="container">
  <h1>üîß ADMINISTRACE HLUBINY MY≈†LEN√ç‚Ñ¢</h1>
  
  <div id="status"></div>
  <div id="storageInfo" class="storage-info"></div>
  
  <form id="messageForm">
    <div class="form-group">
      <label for="messageText">Zpr√°va z hlubiny:</label>
      <textarea id="messageText" placeholder="Zadejte zpr√°vu..." required></textarea>
    </div>
    
    <button type="submit">üì° ODESLAT ZPR√ÅVU</button>
  </form>
  
  <h2>üìã AKTU√ÅLN√ç ZPR√ÅVY</h2>
  <div id="messagesList"></div>
  
  <button onclick="loadMessages()">üîÑ OBNOVIT</button>
</div>

<script>
document.getElementById('messageForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const messageText = document.getElementById('messageText').value;
  
  try {
    const response = await fetch('/api/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        message: messageText
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      showStatus('‚úÖ Zpr√°va byla p≈ôid√°na!', 'success');
      document.getElementById('messageText').value = '';
      loadMessages();
    } else {
      showStatus('‚ùå ' + result.error, 'error');
    }
  } catch (error) {
    showStatus('‚ùå Chyba: ' + error.message, 'error');
  }
});

async function loadMessages() {
  try {
    const response = await fetch('/api/messages');
    const result = await response.json();
    
    if (result.success) {
      displayMessages(result.messages);
      // Zobraz√≠me info o √∫lo≈æi≈°ti a poƒçtu zpr√°v
      if (result.storage) {
        const storageInfo = `üíæ √ölo≈æi≈°tƒõ: ${result.storage}`;
        const countInfo = result.count ? ` | üìä Celkem zpr√°v: ${result.count}` : '';
        document.getElementById('storageInfo').innerHTML = storageInfo + countInfo;
      }
    } else {
      showStatus('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ zpr√°v', 'error');
    }
  } catch (error) {
    showStatus('‚ùå Chyba: ' + error.message, 'error');
  }
}

function displayMessages(messages) {
  const container = document.getElementById('messagesList');
  
  if (messages.length === 0) {
    container.innerHTML = '<p>≈Ω√°dn√© zpr√°vy nenalezeny.</p>';
    return;
  }
  
  container.innerHTML = messages.map(msg => `
    <div class="message-item">
      <div class="message-header">
        <span>ID: ${msg.id}</span>
        <span>${msg.created}</span>
        <button class="delete-btn" onclick="deleteMessage('${msg.id}')">üóë SMAZAT</button>
      </div>
      <div>${formatMessageWithLineBreaks(msg.message)}</div>
    </div>
  `).join('');
}

// Funkce pro konverzi zalomen√≠ ≈ô√°dk≈Ø na HTML <br> tagy
function formatMessageWithLineBreaks(message) {
  if (!message) return '';
  
  // Nahrad√≠me \n a \r\n za <br> tagy a escapujeme HTML
  return message
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;')
    .replace(/\r?\n/g, '<br>');
}

async function deleteMessage(id) {
  if (!confirm('Opravdu chcete smazat tuto zpr√°vu?')) return;
  
  try {
    const response = await fetch('/api/messages', {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: id
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      showStatus('‚úÖ Zpr√°va byla smaz√°na!', 'success');
      loadMessages();
    } else {
      showStatus('‚ùå ' + result.error, 'error');
    }
  } catch (error) {
    showStatus('‚ùå Chyba: ' + error.message, 'error');
  }
}

function showStatus(message, type) {
  const status = document.getElementById('status');
  status.innerHTML = message;
  status.className = `status ${type}`;
  
  setTimeout(() => {
    status.innerHTML = '';
    status.className = '';
  }, 5000);
}

// Naƒçteme zpr√°vy p≈ôi naƒçten√≠ str√°nky
loadMessages();
</script>
</body>
</html>
